# NetCDF

# if nc-config does not exist in your NetCDF installation, set
# this by hand, e.g.:
# NCFLAGS = -I/opt/netcdf/include
# NCLIBS = -L/opt/netcdf/lib -lnetcdf

# if nc-config does exist, these flags can be determined automatically
NCFLAGS = $(shell nc-config --cflags)
NCLIBS = $(shell nc-config --libs)

# C compiler 
CC = gcc
CFLAGS = -g -O0 -std=c99 -posix $(NCFLAGS)

# Fortran compiler
#
# Note:
# * must support the C interoperability part of the FORTRAN 2003 standard
# * must also support the CONVERT specifier in OPEN if reading
#   (big-endian) SPRINTARS data on little-endian architecture (e.g., Intel)
#
# gfortran >= 4.8 is a safe choice in these respects
F90 = gfortran
F90FLAGS = -g -O0

# linker
LD = gcc
LDFLAGS =
LIBS = -lgfortran $(NCLIBS)

CSOURCES = main.c opts.c diag.c convert.c nc.c dims.c

# compile all C files plus read_gtool.f90
OBJECTS = $(CSOURCES:.c=.o) read_gtool.o

BIN = sprintars2nc

all:	$(BIN)

$(BIN):	$(OBJECTS)
	$(LD) $(LDFLAGS) -o $@ $(OBJECTS) $(LIBS)

# we only have one FORTRAN source file; explicit compilation rule:
read_gtool.o:	read_gtool.f90
	$(F90) $(F90FLAGS) $< -c

# implicit rules for C source files and autogenerated dependencies
%.d:	%.c
	@ set -e ; $(CC) -M $(CFLAGS) $< \
                       | sed 's/\($*\)\.o[ :]*/\1.o $@ : /g' > $@; \
                     [ -s $@ ] || rm -f $@
%.o: 	%.c 
	$(CC) $(CFLAGS) $< -c

-include $(CSOURCES:.c=.d)
